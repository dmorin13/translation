<!doctype html>
<html>
<head>
    <title>School Assembly: Teachers</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">

    <div class="page-header text-center">
      <img class= "header-image"src="img/communications.jpg" alt="communications"> 
      <h1 class="welcome">Welcome <span class="user">Ms.Morin!</span> 🍎</h1>
        <a href="/logout" class="btn btn-default btn-sm logout">Logout</a>
    </div>

  
    <div class="row">
      <div class="col-sm-6">
       
       <img class="multilingual"src="img/teacher-parent.png" alt="teacher-parent communications"> 
      </div>
      <div class="col-sm-6">
      </div>
    </div>  

    <div class="col-sm-6">
        <div class="teacher-input col-sm-6 teacher-announcements">
       <% if (user.local.email) { %>
            <form class="" action="/teacher_messages" method="POST">
            <div class="chalkboard_"> 
              <h2 class="postA">Post an Announcement 📝</h2>
              <img class= "chalkboard" src="img/chalkboard.jpeg" alt="chalkboard">
              <input type="text" class="tMessage"  name="msg" placeholder="Message" >
              <input class="name-input teacherName" type="text" name="name" placeholder="Ms.Morin">
            </div>
            <button class="_btn btn-default btn-sm submit" type="submit">Submit</button>
          </form>
          <div class="col-sm-6">
          </div>
        </div>
        <% } %>
        </div>
        
        
        <div class="col-sm-6 pAnnouncements">
          <h3 class="pAnn"> Previous Announcements 📢 </h3>
          
          <ul class="messages">
          <% for(var i=0; i<messages.length; i++) {%>

            <% const relatedComments= comments.filter((comment) => comment.teacherPostId === messages[i]._id.toString())%>
              <%console.log({ msg: 'logging related Comments', relatedComments, comments})%>
        
            <li id="<%= messages[i]._id %>" class="message">
              <span><%= messages[i].role %></span>
              <br/>
              <span class="teacher-msg"><%= messages[i].msg %> -- Ms.Morin</span>
            
              <% if (messages[i].read) { %> 
                <span><i style="color: green"; class="fa fa-check-square-o" aria-hidden="true"></i></span>
              <% } else { %> 
                <span><i data-id="<%= messages[i]._id %>" class="fa fa-check-square-o message-read" aria-hidden="true"></i></span>
              <% } %> 
              
              <span><button class="message-delete" data-id="<%= messages[i]._id %>"> 🚫</button></span>
            <button class="view-comment" type="button" data-id="<%=messages[i]._id%>">View Parents Comments 💬 </button> 
            
            <ul class="hide-comment p-comments">
              
            <% for(let j=0; j < relatedComments.length;j++){%>
              <li> 
                <span class="posterName"><%=relatedComments[j].posterName %> :</span> 
                <span><%=relatedComments[j].commentText["translatedText"]%></span>
        
                <form action="" method="">
                    <input class="" id="replyComment" type="text" class="" name="msg" placeholder="Reply"/>
                  <button class="btn btn-default btn-sm submit" type="submit">Send 📩 </button>
                  <span><button class="comment-delete" data-id="<%=relatedComments[j]._id %>">🚫</button></span>
                </form>
              </li>    
            <%}%> 
            </ul>    
            </li>
          <% } %> 
          </ul>
          <a id="link" href="https://www.bostonpublicschools.org/Page/6919">Request a Live Translator from BPS OELL 🗣️ 📞 </a>
        </div>
      </div>
      <div class="row" hidden>
        <div class="col-sm-6">
          <div class="well">
            <h3><span class="fa fa-user"></span> Local</h3>

            <% if (user.local.email) { %>
                <p>
                    <strong>id</strong>: <%= user._id %><br>
                    <strong>email</strong>: <%= user.local.email %><br>
                    <strong>password</strong>: <%= user.local.password %>
                </p>

                <a href="/unlink/local" class="btn btn-default">Unlink</a>
            <% } else { %>
                <p><a class="link" href="/connect/local" class="btn btn-default">Connect Local</a></p>
            <% } %>
          </div>
        </div>
      </div>

</div>

<script src="main.js"></script>

</body>
</html>

